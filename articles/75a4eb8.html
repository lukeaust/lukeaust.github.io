<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>TensorFlow笔记1-1-结构化数据建模流程范例 | 叶小白</title><meta name="keywords" content=" 深度学习,TensorFlow"><meta name="author" content="叶小白"><meta name="copyright" content="叶小白"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="文章内容源于https:&#x2F;&#x2F;github.com&#x2F;lyhue1991&#x2F;eat_tensorflow2_in_30_days，能力有限，未做太多修改，未来会加入自己的理解。  一、准备数据 titanic数据集的目标是根据乘客信息预测他们在Titanic号撞击冰山沉没后能否生存。 结构化数据一般会使用Pandas中的DataFrame进行预处理。  导入数据 import numpy as np">
<meta property="og:type" content="article">
<meta property="og:title" content="TensorFlow笔记1-1-结构化数据建模流程范例">
<meta property="og:url" content="https://lukeaust.github.io/articles/75a4eb8.html">
<meta property="og:site_name" content="叶小白">
<meta property="og:description" content="文章内容源于https:&#x2F;&#x2F;github.com&#x2F;lyhue1991&#x2F;eat_tensorflow2_in_30_days，能力有限，未做太多修改，未来会加入自己的理解。  一、准备数据 titanic数据集的目标是根据乘客信息预测他们在Titanic号撞击冰山沉没后能否生存。 结构化数据一般会使用Pandas中的DataFrame进行预处理。  导入数据 import numpy as np">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg">
<meta property="article:published_time" content="2020-07-04T13:38:00.000Z">
<meta property="article:modified_time" content="2021-06-29T07:50:09.000Z">
<meta property="article:author" content="叶小白">
<meta property="article:tag" content="tensorflow2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://lukeaust.github.io/articles/75a4eb8"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?effc5e1b8b82b656e64a5c2817817fc2";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'TensorFlow笔记1-1-结构化数据建模流程范例',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-06-29 15:50:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="叶小白" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E8%AE%BA%E6%96%87%E6%91%98%E8%A6%81/"><i class="fa-fw fas fa-thumbs-up"></i><span> 论文摘要</span></a></li><li><a class="site-page child" href="/categories/%E8%AE%BA%E6%96%87%E5%93%81%E8%AF%BB/"><i class="fa-fw fas fa-book"></i><span> 论文品读</span></a></li><li><a class="site-page child" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><i class="fa-fw fas fa-ship"></i><span> 深度学习</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/files/nav.html"><i class="fa-fw fas fa-link"></i><span> 导航</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">叶小白</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E8%AE%BA%E6%96%87%E6%91%98%E8%A6%81/"><i class="fa-fw fas fa-thumbs-up"></i><span> 论文摘要</span></a></li><li><a class="site-page child" href="/categories/%E8%AE%BA%E6%96%87%E5%93%81%E8%AF%BB/"><i class="fa-fw fas fa-book"></i><span> 论文品读</span></a></li><li><a class="site-page child" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><i class="fa-fw fas fa-ship"></i><span> 深度学习</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/files/nav.html"><i class="fa-fw fas fa-link"></i><span> 导航</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">TensorFlow笔记1-1-结构化数据建模流程范例</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-07-04T13:38:00.000Z" title="发表于 2020-07-04 21:38:00">2020-07-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-06-29T07:50:09.000Z" title="更新于 2021-06-29 15:50:09">2021-06-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/TensorFlow/">TensorFlow</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="TensorFlow笔记1-1-结构化数据建模流程范例"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><strong>文章内容源于<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/lyhue1991/eat_tensorflow2_in_30_days">https://github.com/lyhue1991/eat_tensorflow2_in_30_days</a>，能力有限，未做太多修改，未来会加入自己的理解。</strong></p>
<h2 id="一-准备数据"><a class="markdownIt-Anchor" href="#一-准备数据"></a> 一、准备数据</h2>
<p>titanic数据集的目标是<strong>根据乘客信息</strong>预测他们在Titanic号撞击冰山沉没后<strong>能否生存</strong>。</p>
<p>结构化数据一般会使用Pandas中的DataFrame进行预处理。</p>
<h3 id="导入数据"><a class="markdownIt-Anchor" href="#导入数据"></a> 导入数据</h3>
<pre class="highlight"><code class="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np 
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd 
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf 
<span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> models,layers

dftrain_raw = pd.read_csv(<span class="hljs-string">'./data/titanic/train.csv'</span>) <span class="hljs-comment"># dftrain_raw.shape:(712, 12)</span>
dftest_raw = pd.read_csv(<span class="hljs-string">'./data/titanic/test.csv'</span>)
dftrain_raw.head(<span class="hljs-number">10</span>)
</code></pre>
<p>输出结果：</p>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }
<pre><code>.dataframe tbody tr th &#123;
    vertical-align: top;
&#125;

.dataframe thead th &#123;
    text-align: right;
&#125;
</code></pre>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>PassengerId</th>
      <th>Survived</th>
      <th>Pclass</th>
      <th>Name</th>
      <th>Sex</th>
      <th>Age</th>
      <th>SibSp</th>
      <th>Parch</th>
      <th>Ticket</th>
      <th>Fare</th>
      <th>Cabin</th>
      <th>Embarked</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>493</td>
      <td>0</td>
      <td>1</td>
      <td>Molson, Mr. Harry Markland</td>
      <td>male</td>
      <td>55.0</td>
      <td>0</td>
      <td>0</td>
      <td>113787</td>
      <td>30.5000</td>
      <td>C30</td>
      <td>S</td>
    </tr>
    <tr>
      <td>1</td>
      <td>53</td>
      <td>1</td>
      <td>1</td>
      <td>Harper, Mrs. Henry Sleeper (Myna Haxtun)</td>
      <td>female</td>
      <td>49.0</td>
      <td>1</td>
      <td>0</td>
      <td>PC 17572</td>
      <td>76.7292</td>
      <td>D33</td>
      <td>C</td>
    </tr>
    <tr>
      <td>2</td>
      <td>388</td>
      <td>1</td>
      <td>2</td>
      <td>Buss, Miss. Kate</td>
      <td>female</td>
      <td>36.0</td>
      <td>0</td>
      <td>0</td>
      <td>27849</td>
      <td>13.0000</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <td>3</td>
      <td>192</td>
      <td>0</td>
      <td>2</td>
      <td>Carbines, Mr. William</td>
      <td>male</td>
      <td>19.0</td>
      <td>0</td>
      <td>0</td>
      <td>28424</td>
      <td>13.0000</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <td>4</td>
      <td>687</td>
      <td>0</td>
      <td>3</td>
      <td>Panula, Mr. Jaako Arnold</td>
      <td>male</td>
      <td>14.0</td>
      <td>4</td>
      <td>1</td>
      <td>3101295</td>
      <td>39.6875</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <td>5</td>
      <td>16</td>
      <td>1</td>
      <td>2</td>
      <td>Hewlett, Mrs. (Mary D Kingcome)</td>
      <td>female</td>
      <td>55.0</td>
      <td>0</td>
      <td>0</td>
      <td>248706</td>
      <td>16.0000</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <td>6</td>
      <td>228</td>
      <td>0</td>
      <td>3</td>
      <td>Lovell, Mr. John Hall ("Henry")</td>
      <td>male</td>
      <td>20.5</td>
      <td>0</td>
      <td>0</td>
      <td>A/5 21173</td>
      <td>7.2500</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <td>7</td>
      <td>884</td>
      <td>0</td>
      <td>2</td>
      <td>Banfield, Mr. Frederick James</td>
      <td>male</td>
      <td>28.0</td>
      <td>0</td>
      <td>0</td>
      <td>C.A./SOTON 34068</td>
      <td>10.5000</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <td>8</td>
      <td>168</td>
      <td>0</td>
      <td>3</td>
      <td>Skoog, Mrs. William (Anna Bernhardina Karlsson)</td>
      <td>female</td>
      <td>45.0</td>
      <td>1</td>
      <td>4</td>
      <td>347088</td>
      <td>27.9000</td>
      <td>NaN</td>
      <td>S</td>
    </tr>
    <tr>
      <td>9</td>
      <td>752</td>
      <td>1</td>
      <td>3</td>
      <td>Moor, Master. Meier</td>
      <td>male</td>
      <td>6.0</td>
      <td>0</td>
      <td>1</td>
      <td>392096</td>
      <td>12.4750</td>
      <td>E121</td>
      <td>S</td>
    </tr>
  </tbody>
</table>
</div>
<p><strong>字段说明：</strong></p>
<ul>
<li>Survived:0代表死亡，1代表存活【y标签】</li>
<li>Pclass:乘客所持票类，有三种值(1,2,3) 【转换成onehot编码】</li>
<li>Name:乘客姓名 【舍去】</li>
<li>Sex:乘客性别 【转换成bool特征】</li>
<li>Age:乘客年龄(有缺失) 【数值特征，添加“年龄是否缺失”作为辅助特征】</li>
<li>SibSp:乘客兄弟姐妹/配偶的个数(整数值) 【数值特征】</li>
<li>Parch:乘客父母/孩子的个数(整数值)【数值特征】</li>
<li>Ticket:票号(字符串)【舍去】</li>
<li>Fare:乘客所持票的价格(浮点数，0-500不等) 【数值特征】</li>
<li>Cabin:乘客所在船舱(有缺失) 【添加“所在船舱是否缺失”作为辅助特征】</li>
<li>Embarked:乘客登船港口:S、C、Q(有缺失)【转换成onehot编码，四维度 S,C,Q,nan】</li>
</ul>
<p><strong>数据调用：</strong><br />
直接通过字段名调用。</p>
<pre class="highlight"><code class="python">print(dftrain_raw[<span class="hljs-string">'Survived'</span>])
</code></pre>
<p>输出结果：</p>
<pre class="highlight"><code class="log">    0      0
    1      1
    2      1
    3      0
    4      0
          ..
    707    1
    708    0
    709    0
    710    0
    711    0
    Name: Survived, Length: 712, dtype: int64
</code></pre>
<h3 id="简单查看label分布情况"><a class="markdownIt-Anchor" href="#简单查看label分布情况"></a> 简单查看label分布情况</h3>
<p>利用Pandas的数据可视化功能我们可以简单地进行<strong>探索性数据分析EDA</strong>（Exploratory Data Analysis）。</p>
<pre class="highlight"><code class="python">%matplotlib inline
%config InlineBackend.figure_format = <span class="hljs-string">'png'</span>
ax = dftrain_raw[<span class="hljs-string">'Survived'</span>].value_counts().plot(kind = <span class="hljs-string">'bar'</span>,
     figsize = (<span class="hljs-number">12</span>,<span class="hljs-number">8</span>),fontsize=<span class="hljs-number">15</span>,rot = <span class="hljs-number">0</span>)
ax.set_ylabel(<span class="hljs-string">'Counts'</span>,fontsize = <span class="hljs-number">15</span>)
ax.set_xlabel(<span class="hljs-string">'Survived'</span>,fontsize = <span class="hljs-number">15</span>)
plt.show()
</code></pre>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/articles/75a4eb8/output_7_0.png" class="">
<p>年龄分布情况</p>
<pre class="highlight"><code class="python">%matplotlib inline
%config InlineBackend.figure_format = <span class="hljs-string">'png'</span>
ax = dftrain_raw[<span class="hljs-string">'Age'</span>].plot(kind = <span class="hljs-string">'hist'</span>,bins = <span class="hljs-number">20</span>,color= <span class="hljs-string">'purple'</span>,
                    figsize = (<span class="hljs-number">12</span>,<span class="hljs-number">8</span>),fontsize=<span class="hljs-number">15</span>)

ax.set_ylabel(<span class="hljs-string">'Frequency'</span>,fontsize = <span class="hljs-number">15</span>)
ax.set_xlabel(<span class="hljs-string">'Age'</span>,fontsize = <span class="hljs-number">15</span>)
plt.show()
</code></pre>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/articles/75a4eb8/output_9_0.png" class="">
<p>获取满足<code>Survived==0</code>的字段为<code>Name</code>的数据项</p>
<pre class="highlight"><code class="python">print(dftrain_raw.query(<span class="hljs-string">'Survived==0'</span>)[<span class="hljs-string">'Name'</span>])
</code></pre>
<pre><code>0                             Molson, Mr. Harry Markland
3                                  Carbines, Mr. William
4                               Panula, Mr. Jaako Arnold
6                        Lovell, Mr. John Hall (&quot;Henry&quot;)
7                          Banfield, Mr. Frederick James
                             ...                        
706    Vander Planke, Mrs. Julius (Emelia Maria Vande...
708                                Stewart, Mr. Albert A
709                                   Ekstrom, Mr. Johan
710                                 Fynney, Mr. Joseph J
711                          Clifford, Mr. George Quincy
Name: Name, Length: 433, dtype: object
</code></pre>
<p>年龄和label的相关性</p>
<pre class="highlight"><code class="python">%matplotlib inline
%config InlineBackend.figure_format = <span class="hljs-string">'png'</span>
ax = dftrain_raw.query(<span class="hljs-string">'Survived == 0'</span>)[<span class="hljs-string">'Age'</span>].plot(kind = <span class="hljs-string">'density'</span>,figsize = (<span class="hljs-number">12</span>,<span class="hljs-number">8</span>),fontsize=<span class="hljs-number">15</span>)
dftrain_raw.query(<span class="hljs-string">'Survived == 1'</span>)[<span class="hljs-string">'Age'</span>].plot(kind = <span class="hljs-string">'density'</span>,figsize = (<span class="hljs-number">12</span>,<span class="hljs-number">8</span>),fontsize=<span class="hljs-number">15</span>)
ax.legend([<span class="hljs-string">'Survived==0'</span>,<span class="hljs-string">'Survived==1'</span>],fontsize = <span class="hljs-number">12</span>) <span class="hljs-comment"># 图例</span>
ax.set_ylabel(<span class="hljs-string">'Density'</span>,fontsize = <span class="hljs-number">15</span>) <span class="hljs-comment"># y轴</span>
ax.set_xlabel(<span class="hljs-string">'Age'</span>,fontsize = <span class="hljs-number">15</span>) <span class="hljs-comment"># x轴</span>
plt.show()
</code></pre>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/articles/75a4eb8/output_13_0.png" class="">
<p>下面为正式的数据预处理</p>
<pre class="highlight"><code class="python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">preprocessing</span><span class="hljs-params">(dfdata)</span>:</span>
<span class="hljs-comment"># 分别对每个字段进行预处理</span>
    dfresult= pd.DataFrame() <span class="hljs-comment"># 初始化，逐步添加处理后的数据属性</span>
  
    <span class="hljs-comment">#Pclass:乘客所持票类，有三种值(1,2,3) 【转换成onehot编码】</span>
    dfPclass = pd.get_dummies(dfdata[<span class="hljs-string">'Pclass'</span>]) <span class="hljs-comment"># one hot 编码</span>
    dfPclass.columns = [<span class="hljs-string">'Pclass_'</span> +str(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> dfPclass.columns ] <span class="hljs-comment">#  Index(['Pclass_1', 'Pclass_2', 'Pclass_3'], dtype='object')</span>
    dfresult = pd.concat([dfresult,dfPclass],axis = <span class="hljs-number">1</span>)
    
    <span class="hljs-comment">#Sex:乘客性别 【转换成bool特征】</span>
    dfSex = pd.get_dummies(dfdata[<span class="hljs-string">'Sex'</span>]) <span class="hljs-comment"># one hot 编码</span>
    dfresult = pd.concat([dfresult,dfSex],axis = <span class="hljs-number">1</span>)
    print(dfresult.head(<span class="hljs-number">3</span>))
    
    <span class="hljs-comment">#Age</span>
    dfresult[<span class="hljs-string">'Age'</span>] = dfdata[<span class="hljs-string">'Age'</span>].fillna(<span class="hljs-number">0</span>) <span class="hljs-comment"># 用0填充空值</span>
    dfresult[<span class="hljs-string">'Age_null'</span>] = pd.isna(dfdata[<span class="hljs-string">'Age'</span>]).astype(<span class="hljs-string">'int32'</span>) <span class="hljs-comment"># 标记空值项(astype:字段类型转换)</span>

    
    <span class="hljs-comment">#SibSp,Parch,Fare:都是整数值，无缺失值，不需要处理</span>
    dfresult[<span class="hljs-string">'SibSp'</span>] = dfdata[<span class="hljs-string">'SibSp'</span>]
    dfresult[<span class="hljs-string">'Parch'</span>] = dfdata[<span class="hljs-string">'Parch'</span>]
    dfresult[<span class="hljs-string">'Fare'</span>] = dfdata[<span class="hljs-string">'Fare'</span>]

    <span class="hljs-comment">#Carbin：有缺失值</span>
    dfresult[<span class="hljs-string">'Cabin_null'</span>] =  pd.isna(dfdata[<span class="hljs-string">'Cabin'</span>]).astype(<span class="hljs-string">'int32'</span>)

    <span class="hljs-comment">#Embarked:乘客登船港口:S、C、Q(有缺失)【转换成onehot编码，四维度 S,C,Q,nan】</span>
    dfEmbarked = pd.get_dummies(dfdata[<span class="hljs-string">'Embarked'</span>],dummy_na=<span class="hljs-literal">True</span>)
    dfEmbarked.columns = [<span class="hljs-string">'Embarked_'</span> + str(x) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> dfEmbarked.columns] <span class="hljs-comment"># 字段重命名</span>
    dfresult = pd.concat([dfresult,dfEmbarked],axis = <span class="hljs-number">1</span>)

    <span class="hljs-keyword">return</span>(dfresult)

print(<span class="hljs-string">"处理训练集数据："</span>)
x_train = preprocessing(dftrain_raw)
y_train = dftrain_raw[<span class="hljs-string">'Survived'</span>].values

print(<span class="hljs-string">"处理测试集数据："</span>)
x_test = preprocessing(dftest_raw)
y_test = dftest_raw[<span class="hljs-string">'Survived'</span>].values

print(<span class="hljs-string">"x_train.shape ="</span>, x_train.shape )
print(<span class="hljs-string">"x_test.shape ="</span>, x_test.shape )

</code></pre>
<p>输出结果：</p>
<pre><code>处理训练集数据：
   Pclass_1  Pclass_2  Pclass_3  female  male
0         1         0         0       0     1
1         1         0         0       1     0
2         0         1         0       1     0
处理测试集数据：
   Pclass_1  Pclass_2  Pclass_3  female  male
0         0         0         1       1     0
1         0         0         1       1     0
2         0         0         1       1     0
x_train.shape = (712, 15)
x_test.shape = (179, 15)
</code></pre>
<h2 id="二-定义模型"><a class="markdownIt-Anchor" href="#二-定义模型"></a> 二、定义模型</h2>
<p>使用Keras接口有以下3种方式构建模型：</p>
<ul>
<li>使用Sequential按层顺序构建模型</li>
<li>使用函数式API构建任意结构模型</li>
<li>继承Model基类构建自定义模型</li>
</ul>
<p>此处选择使用最简单的Sequential，按层顺序模型，一层一层往前，没有什么环的结构。比如像前馈网络那样。</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/articles/75a4eb8/1.jpg" class="">
<p><strong><a target="_blank" rel="noopener external nofollow noreferrer" href="https://keras-cn.readthedocs.io/en/latest/layers/core_layer/#dense">Dense层</a></strong></p>
<pre class="highlight"><code class="">keras.layers.core.Dense(units, activation=None, use_bias=True, kernel_initializer='glorot_uniform', bias_initializer='zeros', kernel_regularizer=None, bias_regularizer=None, activity_regularizer=None, kernel_constraint=None, bias_constraint=None)
</code></pre>
<p>Dense就是常用的<strong>全连接层</strong>，所实现的运算是<code>output = activation(dot(input, kernel)+bias)</code>。其中<code>activation</code>是逐元素计算的激活函数，<code>kernel</code>是本层的权值矩阵，<code>bias</code>为偏置向量，只有当<code>use_bias=True</code>才会添加。</p>
<pre class="highlight"><code class="python">tf.keras.backend.clear_session()

model = models.Sequential()
model.add(layers.Dense(<span class="hljs-number">20</span>,activation = <span class="hljs-string">'relu'</span>,input_shape=(<span class="hljs-number">15</span>,)))
model.add(layers.Dense(<span class="hljs-number">10</span>,activation = <span class="hljs-string">'relu'</span> ))
model.add(layers.Dense(<span class="hljs-number">1</span>,activation = <span class="hljs-string">'sigmoid'</span> ))

model.summary()
</code></pre>
<p>输出结果：</p>
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense (Dense)                (None, 20)                320       
_________________________________________________________________
dense_1 (Dense)              (None, 10)                210       
_________________________________________________________________
dense_2 (Dense)              (None, 1)                 11        
=================================================================
Total params: 541
Trainable params: 541
Non-trainable params: 0
_________________________________________________________________
</code></pre>
<p><em><em>注：Param = （输入数据维度+1）</em> 神经元个数</em>*</p>
<h2 id="三-训练模型"><a class="markdownIt-Anchor" href="#三-训练模型"></a> 三、训练模型</h2>
<p>训练模型通常有3种方法，内置fit方法，内置train_on_batch方法，以及自定义训练循环。此处我们选择最常用也最简单的内置fit方法。</p>
<pre class="highlight"><code class="python"><span class="hljs-comment"># 在训练模型之前，我们需要通过compile来对学习过程进行配置</span>
<span class="hljs-comment"># 二分类问题选择二元交叉熵损失函数</span>
model.compile(optimizer=<span class="hljs-string">'adam'</span>,
            loss=<span class="hljs-string">'binary_crossentropy'</span>,
            metrics=[<span class="hljs-string">'AUC'</span>]) <span class="hljs-comment"># 优化器optimizer，损失函数loss，指标列表metrics</span>

<span class="hljs-comment"># fit函数返回一个History的对象，其History.history属性记录了损失函数和其他指标的数值随epoch变化的情况，</span>
<span class="hljs-comment"># 如果有验证集的话，也包含了验证集的这些指标变化情况</span>
history = model.fit(x_train,y_train,
                    batch_size= <span class="hljs-number">64</span>,
                    epochs= <span class="hljs-number">30</span>,
                    validation_split=<span class="hljs-number">0.2</span> <span class="hljs-comment">#分割一部分训练数据用于验证</span>
                   )
</code></pre>
<p>输出结果：</p>
<pre><code>WARNING:tensorflow:Falling back from v2 loop because of error: Failed to find data adapter that can handle input: &lt;class 'pandas.core.frame.DataFrame'&gt;, &lt;class 'NoneType'&gt;
Train on 569 samples, validate on 143 samples
Epoch 1/30
569/569 [==============================] - 1s 1ms/sample - loss: 1.2484 - AUC: 0.6961 - val_loss: 1.2753 - val_AUC: 0.6402
Epoch 2/30
569/569 [==============================] - 0s 33us/sample - loss: 1.0516 - AUC: 0.6979 - val_loss: 1.0833 - val_AUC: 0.6406
Epoch 3/30
569/569 [==============================] - 0s 32us/sample - loss: 0.8833 - AUC: 0.6969 - val_loss: 0.9255 - val_AUC: 0.6416
Epoch 4/30
569/569 [==============================] - 0s 30us/sample - loss: 0.7475 - AUC: 0.6963 - val_loss: 0.8021 - val_AUC: 0.6411
Epoch 5/30
569/569 [==============================] - 0s 32us/sample - loss: 0.6646 - AUC: 0.6970 - val_loss: 0.7445 - val_AUC: 0.6283
Epoch 6/30
569/569 [==============================] - 0s 35us/sample - loss: 0.6412 - AUC: 0.6784 - val_loss: 0.7099 - val_AUC: 0.6140
Epoch 7/30
569/569 [==============================] - 0s 33us/sample - loss: 0.6238 - AUC: 0.6881 - val_loss: 0.6831 - val_AUC: 0.6316
Epoch 8/30
569/569 [==============================] - 0s 33us/sample - loss: 0.6184 - AUC: 0.7025 - val_loss: 0.6697 - val_AUC: 0.6365
Epoch 9/30
569/569 [==============================] - 0s 32us/sample - loss: 0.6098 - AUC: 0.7138 - val_loss: 0.6652 - val_AUC: 0.6345
Epoch 10/30
569/569 [==============================] - 0s 33us/sample - loss: 0.6039 - AUC: 0.7223 - val_loss: 0.6636 - val_AUC: 0.6434
Epoch 11/30
569/569 [==============================] - 0s 39us/sample - loss: 0.5974 - AUC: 0.7318 - val_loss: 0.6544 - val_AUC: 0.6511
Epoch 12/30
569/569 [==============================] - 0s 37us/sample - loss: 0.5934 - AUC: 0.7375 - val_loss: 0.6490 - val_AUC: 0.6610
Epoch 13/30
569/569 [==============================] - 0s 40us/sample - loss: 0.5893 - AUC: 0.7415 - val_loss: 0.6486 - val_AUC: 0.6578
Epoch 14/30
569/569 [==============================] - 0s 42us/sample - loss: 0.5859 - AUC: 0.7447 - val_loss: 0.6428 - val_AUC: 0.6692
Epoch 15/30
569/569 [==============================] - 0s 42us/sample - loss: 0.5836 - AUC: 0.7511 - val_loss: 0.6374 - val_AUC: 0.6804
Epoch 16/30
569/569 [==============================] - 0s 47us/sample - loss: 0.5774 - AUC: 0.7600 - val_loss: 0.6367 - val_AUC: 0.6828
Epoch 17/30
569/569 [==============================] - 0s 37us/sample - loss: 0.5745 - AUC: 0.7595 - val_loss: 0.6349 - val_AUC: 0.6877
Epoch 18/30
569/569 [==============================] - 0s 30us/sample - loss: 0.5719 - AUC: 0.7696 - val_loss: 0.6288 - val_AUC: 0.7008
Epoch 19/30
569/569 [==============================] - 0s 32us/sample - loss: 0.5676 - AUC: 0.7751 - val_loss: 0.6262 - val_AUC: 0.7071
Epoch 20/30
569/569 [==============================] - 0s 32us/sample - loss: 0.5645 - AUC: 0.7792 - val_loss: 0.6282 - val_AUC: 0.7136
Epoch 21/30
569/569 [==============================] - 0s 30us/sample - loss: 0.5608 - AUC: 0.7853 - val_loss: 0.6232 - val_AUC: 0.7196
Epoch 22/30
569/569 [==============================] - 0s 30us/sample - loss: 0.5596 - AUC: 0.7901 - val_loss: 0.6205 - val_AUC: 0.7226
Epoch 23/30
569/569 [==============================] - 0s 30us/sample - loss: 0.5556 - AUC: 0.7900 - val_loss: 0.6237 - val_AUC: 0.7279
Epoch 24/30
569/569 [==============================] - 0s 32us/sample - loss: 0.5510 - AUC: 0.7980 - val_loss: 0.6190 - val_AUC: 0.7275
Epoch 25/30
569/569 [==============================] - 0s 32us/sample - loss: 0.5494 - AUC: 0.8079 - val_loss: 0.6146 - val_AUC: 0.7333
Epoch 26/30
569/569 [==============================] - 0s 30us/sample - loss: 0.5446 - AUC: 0.8102 - val_loss: 0.6216 - val_AUC: 0.7341
Epoch 27/30
569/569 [==============================] - 0s 30us/sample - loss: 0.5429 - AUC: 0.8101 - val_loss: 0.6133 - val_AUC: 0.7390
Epoch 28/30
569/569 [==============================] - 0s 32us/sample - loss: 0.5379 - AUC: 0.8185 - val_loss: 0.6165 - val_AUC: 0.7356
Epoch 29/30
569/569 [==============================] - 0s 30us/sample - loss: 0.5355 - AUC: 0.8169 - val_loss: 0.6176 - val_AUC: 0.7398
Epoch 30/30
569/569 [==============================] - 0s 33us/sample - loss: 0.5322 - AUC: 0.8237 - val_loss: 0.6082 - val_AUC: 0.7451
</code></pre>
<h3 id="四-评估模型"><a class="markdownIt-Anchor" href="#四-评估模型"></a> 四、评估模型</h3>
<p>我们首先评估一下模型在训练集和验证集上的效果。</p>
<pre class="highlight"><code class="python">%matplotlib inline
%config InlineBackend.figure_format = <span class="hljs-string">'svg'</span>

<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_metric</span><span class="hljs-params">(history, metric)</span>:</span>
    train_metrics = history.history[metric] <span class="hljs-comment"># history.history是一个json数组</span>
    val_metrics = history.history[<span class="hljs-string">'val_'</span>+metric]
    epochs = range(<span class="hljs-number">1</span>, len(train_metrics) + <span class="hljs-number">1</span>) <span class="hljs-comment"># 次数range(1, 31)</span>
    plt.plot(epochs, train_metrics, <span class="hljs-string">'bo--'</span>)
    plt.plot(epochs, val_metrics, <span class="hljs-string">'ro-'</span>)
    plt.title(<span class="hljs-string">'Training and validation '</span>+ metric)
    plt.xlabel(<span class="hljs-string">"Epochs"</span>)
    plt.ylabel(metric)
    plt.legend([<span class="hljs-string">"train_"</span>+metric, <span class="hljs-string">'val_'</span>+metric])
    plt.show()
</code></pre>
<pre class="highlight"><code class="python">plot_metric(history,<span class="hljs-string">"loss"</span>)
</code></pre>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/articles/75a4eb8/output_26_0.svg" class="">
<pre class="highlight"><code class="python">plot_metric(history,<span class="hljs-string">"AUC"</span>)
</code></pre>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/articles/75a4eb8/output_27_0.svg" class="">
<p>我们再看一下模型在测试集上的效果.</p>
<pre class="highlight"><code class="python"><span class="hljs-comment"># 输入数据和标签,输出损失和精确度</span>
model.evaluate(x = x_test,y = y_test) 
</code></pre>
<p>输出结果：</p>
<pre><code>WARNING:tensorflow:Falling back from v2 loop because of error: Failed to find data adapter that can handle input: &lt;class 'pandas.core.frame.DataFrame'&gt;, &lt;class 'NoneType'&gt;
179/179 [==============================] - 0s 39us/sample - loss: 0.5423 - AUC: 0.8155

[0.5422718674776941, 0.8154762]
</code></pre>
<h3 id="五-使用模型"><a class="markdownIt-Anchor" href="#五-使用模型"></a> 五、使用模型</h3>
<p>当使用**predict()**方法进行预测时，返回值是数值，表示样本属于每一个类别的概率。</p>
<pre class="highlight"><code class="python"><span class="hljs-comment">#预测概率。输入测试数据,输出预测结果</span>
model.predict(x_test[<span class="hljs-number">0</span>:<span class="hljs-number">10</span>])
<span class="hljs-comment">#model(tf.constant(x_test[0:10].values,dtype = tf.float32)) #等价写法</span>
</code></pre>
<p>输出结果：</p>
<pre><code>WARNING:tensorflow:Falling back from v2 loop because of error: Failed to find data adapter that can handle input: &lt;class 'pandas.core.frame.DataFrame'&gt;, &lt;class 'NoneType'&gt;
array([[0.43267167],
       [0.45143938],
       [0.3366692 ],
       [0.7563272 ],
       [0.4854551 ],
       [0.5545151 ],
       [0.23698094],
       [0.5242109 ],
       [0.50638825],
       [0.21195236]], dtype=float32)
</code></pre>
<p>当使用**predict_classes()**方法进行预测时，返回的是类别的索引，即该样本所属的类别标签</p>
<pre class="highlight"><code class="python"><span class="hljs-comment">#预测类别</span>
model.predict_classes(x_test[<span class="hljs-number">0</span>:<span class="hljs-number">10</span>])
</code></pre>
<p>输出结果：</p>
<pre><code>WARNING:tensorflow:Falling back from v2 loop because of error: Failed to find data adapter that can handle input: &lt;class 'pandas.core.frame.DataFrame'&gt;, &lt;class 'NoneType'&gt;
array([[0],
       [0],
       [0],
       [1],
       [0],
       [1],
       [0],
       [1],
       [1],
       [0]])
</code></pre>
<h3 id="六-保存模型"><a class="markdownIt-Anchor" href="#六-保存模型"></a> 六、保存模型</h3>
<p>可以使用Keras方式保存模型，也可以使用TensorFlow原生方式保存。前者仅仅适合使用Python环境恢复模型，后者则可以跨平台进行模型部署。</p>
<p>推荐使用后一种方式进行保存。</p>
<h3 id="1-keras方式保存"><a class="markdownIt-Anchor" href="#1-keras方式保存"></a> 1. Keras方式保存</h3>
<pre class="highlight"><code class="python"><span class="hljs-comment"># 保存模型结构及权重</span>

model.save(<span class="hljs-string">'./data/keras_model.h5'</span>)  

<span class="hljs-keyword">del</span> model  <span class="hljs-comment">#删除现有模型</span>

<span class="hljs-comment"># identical to the previous one</span>
model = models.load_model(<span class="hljs-string">'./data/keras_model.h5'</span>)
model.evaluate(x_test,y_test)
</code></pre>
<p>输出结果：</p>
<pre><code>WARNING:tensorflow:Falling back from v2 loop because of error: Failed to find data adapter that can handle input: &lt;class 'pandas.core.frame.DataFrame'&gt;, &lt;class 'NoneType'&gt;
179/179 [==============================] - 0s 558us/sample - loss: 0.5423 - AUC: 0.8155
[0.5422718674776941, 0.8154762]
</code></pre>
<pre class="highlight"><code class="python"><span class="hljs-comment"># 保存模型结构</span>
json_str = model.to_json()

<span class="hljs-comment"># 恢复模型结构</span>
model_json = models.model_from_json(json_str)
</code></pre>
<pre class="highlight"><code class="python"><span class="hljs-comment">#保存模型权重</span>
model.save_weights(<span class="hljs-string">'./data/keras_model_weight.h5'</span>)

<span class="hljs-comment"># 恢复模型结构</span>
model_json = models.model_from_json(json_str)
model_json.compile(
        optimizer=<span class="hljs-string">'adam'</span>,
        loss=<span class="hljs-string">'binary_crossentropy'</span>,
        metrics=[<span class="hljs-string">'AUC'</span>]
    )

<span class="hljs-comment"># 加载权重</span>
model_json.load_weights(<span class="hljs-string">'./data/keras_model_weight.h5'</span>)
model_json.evaluate(x_test,y_test)
</code></pre>
<p>输出结果：</p>
<pre><code>WARNING:tensorflow:Falling back from v2 loop because of error: Failed to find data adapter that can handle input: &lt;class 'pandas.core.frame.DataFrame'&gt;, &lt;class 'NoneType'&gt;
179/179 [==============================] - 0s 597us/sample - loss: 0.5423 - AUC: 0.8155

[0.5422718674776941, 0.8154762]
</code></pre>
<h3 id="2-tensorflow原生方式保存"><a class="markdownIt-Anchor" href="#2-tensorflow原生方式保存"></a> 2. TensorFlow原生方式保存</h3>
<pre class="highlight"><code class="python"><span class="hljs-comment"># 保存权重，该方式仅仅保存权重张量</span>
model.save_weights(<span class="hljs-string">'./data/tf_model_weights.ckpt'</span>,save_format = <span class="hljs-string">"tf"</span>)
</code></pre>
<pre class="highlight"><code class="python"><span class="hljs-comment"># 保存模型结构与模型参数到文件,该方式保存的模型具有跨平台性便于部署</span>

model.save(<span class="hljs-string">'./data/tf_model_savedmodel'</span>, save_format=<span class="hljs-string">"tf"</span>)
print(<span class="hljs-string">'export saved model.'</span>)

model_loaded = tf.keras.models.load_model(<span class="hljs-string">'./data/tf_model_savedmodel'</span>)
model_loaded.evaluate(x_test,y_test)
</code></pre>
<p>输出结果：</p>
<pre><code>WARNING:tensorflow:From D:\Anaconda3\lib\site-packages\tensorflow_core\python\ops\resource_variable_ops.py:1781: calling BaseResourceVariable.__init__ (from tensorflow.python.ops.resource_variable_ops) with constraint is deprecated and will be removed in a future version.
Instructions for updating:
If using Keras pass *_constraint arguments to layers.
INFO:tensorflow:Assets written to: ./data/tf_model_savedmodel\assets
export saved model.
WARNING:tensorflow:Falling back from v2 loop because of error: Failed to find data adapter that can handle input: &lt;class 'pandas.core.frame.DataFrame'&gt;, &lt;class 'NoneType'&gt;
179/179 [==============================] - 0s 581us/sample - loss: 0.5423 - AUC: 0.8155

[0.5422718674776941, 0.8154762]</code></pre>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/tensorflow2/">tensorflow2</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/articles/a7ad5f6b.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">TensorFlow笔记1-2-图片数据建模流程范例</div></div></a></div><div class="next-post pull-right"><a href="/articles/ff1614d5.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">TensorFlow笔记1-0-建模流程</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/articles/a7ad5f6b.html" title="TensorFlow笔记1-2-图片数据建模流程范例"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-05</div><div class="title">TensorFlow笔记1-2-图片数据建模流程范例</div></div></a></div><div><a href="/articles/9067d43.html" title="TensorFlow笔记1-3-文本数据建模流程范例"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-05</div><div class="title">TensorFlow笔记1-3-文本数据建模流程范例</div></div></a></div><div><a href="/articles/a434a164.html" title="TensorFlow笔记2-0-核心概念"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-05</div><div class="title">TensorFlow笔记2-0-核心概念</div></div></a></div><div><a href="/articles/ff1614d5.html" title="TensorFlow笔记1-0-建模流程"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-04</div><div class="title">TensorFlow笔记1-0-建模流程</div></div></a></div><div><a href="/articles/aa5ab9b1.html" title="TensorFlow笔记1-4-时间序列数据建模流程范例"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-05</div><div class="title">TensorFlow笔记1-4-时间序列数据建模流程范例</div></div></a></div><div><a href="/articles/94346f49.html" title="TensorFlow笔记2-3-自动微分机制"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-06</div><div class="title">TensorFlow笔记2-3-自动微分机制</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">叶小白</div><div class="author-info__description">用智慧丈量人生</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">51</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">47</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/lukeaust"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/lukeaust" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/lukeaust@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">一入学术深似海</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE"><span class="toc-number">1.</span> <span class="toc-text"> 一、准备数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.</span> <span class="toc-text"> 导入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E7%9C%8Blabel%E5%88%86%E5%B8%83%E6%83%85%E5%86%B5"><span class="toc-number">1.2.</span> <span class="toc-text"> 简单查看label分布情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text"> 二、定义模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text"> 三、训练模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-%E8%AF%84%E4%BC%B0%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.1.</span> <span class="toc-text"> 四、评估模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text"> 五、使用模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD-%E4%BF%9D%E5%AD%98%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.3.</span> <span class="toc-text"> 六、保存模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-keras%E6%96%B9%E5%BC%8F%E4%BF%9D%E5%AD%98"><span class="toc-number">3.4.</span> <span class="toc-text"> 1. Keras方式保存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-tensorflow%E5%8E%9F%E7%94%9F%E6%96%B9%E5%BC%8F%E4%BF%9D%E5%AD%98"><span class="toc-number">3.5.</span> <span class="toc-text"> 2. TensorFlow原生方式保存</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/articles/0.html" title="无题"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/articles/0.html" title="无题">无题</a><time datetime="2021-06-30T10:40:24.104Z" title="发表于 2021-06-30 18:40:24">2021-06-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/0.html" title="无题"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/articles/0.html" title="无题">无题</a><time datetime="2021-06-30T01:52:56.702Z" title="发表于 2021-06-30 09:52:56">2021-06-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/d737cada.html" title="无题"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/articles/d737cada.html" title="无题">无题</a><time datetime="2021-06-29T08:17:57.731Z" title="发表于 2021-06-29 16:17:57">2021-06-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/articles/85537cbc.html" title="无题"><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cdn.jsdelivr.net/gh/lukeaust/blog/img/fairy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/articles/85537cbc.html" title="无题">无题</a><time datetime="2021-06-29T08:17:57.611Z" title="发表于 2021-06-29 16:17:57">2021-06-29</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/articles/bd53aba9.html" title="使用Aurora+Algorithm2e在word中输入伪码">使用Aurora+Algorithm2e在word中输入伪码</a><time datetime="2021-04-26T02:49:03.346Z" title="发表于 2021-04-26 10:49:03">2021-04-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2021 By 叶小白</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'Sa9Gr02xMinB8aMKhiaxPCsP-gzGzoHsz',
      appKey: 'Q99L5wMhgk70QnUTbJxiEcA5',
      placeholder: '记得留下你的昵称和邮箱....可以快速收到回复',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>